
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Temporizadores</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <script th:inline="javascript">
/* <![CDATA[ */
function atualizarTemporizador() {
    setInterval(function () {
        var temporizadores = document.querySelectorAll('.temporizador');
        temporizadores.forEach(function (temporizador) {
            var id = temporizador.getAttribute('data-id');
            var dataFinal = new Date(temporizador.getAttribute('data-data'));
            var agora = new Date();
            var diferenca = dataFinal - agora;

            if (diferenca > 0) {
                var dias = Math.floor(diferenca / (1000 * 60 * 60 * 24));
                var horas = Math.floor((diferenca % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutos = Math.floor((diferenca % (1000 * 60 * 60)) / (1000 * 60));
                var segundos = Math.floor((diferenca % (1000 * 60)) / 1000);

                var diasElement = document.querySelector('.temporizador-dias[data-id="' + id + '"]');
                var horasElement = document.querySelector('.temporizador-horas[data-id="' + id + '"]');
                var minutosElement = document.querySelector('.temporizador-minutos[data-id="' + id + '"]');
                var segundosElement = document.querySelector('.temporizador-segundos[data-id="' + id + '"]');

                if (diasElement && horasElement && minutosElement && segundosElement) {
                    diasElement.innerHTML = dias;
                    horasElement.innerHTML = horas;
                    minutosElement.innerHTML = minutos;
                    segundosElement.innerHTML = segundos;
                }
            } else {
                var todosTemporizadores = document.querySelectorAll('.temporizador[data-id="' + id + '"]');
                todosTemporizadores.forEach(function (temporizadorExpirado) {
                    temporizadorExpirado.innerHTML = "Tempo expirado";
                });
            }

            var formattedDate = formatarData(dataFinal);
            var dataElement = document.querySelector('.temporizador-data[data-id="' + id + '"]');
            if (dataElement) {
                dataElement.innerHTML = formattedDate;
            }
        });
    }, 1000);
}

document.addEventListener("DOMContentLoaded", function () {
    atualizarTemporizador();
});
/* ]]> */
    </script>

</head>    <style>
    * {
        margin: 20;
        padding: 20;
        font-family: 'Open Sans', sans-serif;
    }

    body {
        background: linear-gradient(120deg, #ffe53bd8, #ff2525da);
        margin: 20;
        padding:20;
        font-family: 'Open Sans', sans-serif;
        height: 640px;
    }

    .container {
        text-align: center;
        margin: 20px;
    }

    .header {
        margin-bottom: 20px;
    }

    .relogios-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }

    .relogio {
        width: 100%;
        max-width: 600px; /* Adicionei uma largura máxima para evitar que fique muito largo */
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 8px 10px rgba(0, 0, 0, 0.5);
        color: #fff;
        background: rgba(5, 5, 5, .9);
        letter-spacing: 3px;
        margin-bottom: 20px;
    }

    .temporizador {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .tempo {
        display: flex;
        justify-content: space-around;
        align-items: center;
        font-size: 18px;
        margin-bottom: 10px;
    }

    .tempo div {
        flex: 1;
        text-align: center;
    }

    .temporizador-dias,
    .temporizador-horas,
    .temporizador-minutos,
    .temporizador-segundos {
        flex: 1;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
    }

    .info div {
        font-size: 25px;
        margin-top: 10px;
    }

    button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
    }
    input[type="submit"] {
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
        text-align: center;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 8px 10px rgba(0, 0, 0, 0.5);

        letter-spacing: 3px;
        width: 100%;
        max-width: 400px;
    }

    .excluir{
        background-color: #ff1100;
        color: #fff;
        cursor: pointer;
        text-align: center;
        padding: 5px;
        border-radius: 10px;
        box-shadow: 0px 8px 10px rgba(0, 0, 0, 0.5);
        letter-spacing: 3px;
        text-decoration: none;
    }

    .aviso{
        background-color: rgba(0, 0, 0, 0.5);;
        color: #fff;
        text-align: center;
        padding: 20px;
        margin: 20px;
        border-radius: 10px;
        box-shadow: 0px 8px 10px rgba(0, 0, 0, 0.5);
        letter-spacing: 3px;
        text-decoration: none; 
    }
</style>

<body>
    <div class="container">
        <div class="header">
            <h1 id="titulo">Temporizadores</h1>
        </div>
        
        <div class="relogios-container">
            <div th:each="temporizador : ${temporizadores}" class="relogio">
                <div class="info">
                    <div th:text="${temporizador.titulo}"></div>
                    <div th:text="${temporizador.dataFormatada}"></div>
                </div>
                <div class="temporizador" th:attr="data-id=${temporizador.id}, data-data=${temporizador.data}"></div>
                
                <div class="tempo">
                    <div>Dias</div>
                    <div>Horas</div>
                    <div>Minutos</div>
                    <div>Segundos</div>
                </div>
                <div class="tempo">
                    <div class="temporizador-dias" th:attr="data-id=${temporizador.id}">0</div>
                    <div class="temporizador-horas" th:attr="data-id=${temporizador.id}">0</div>
                    <div class="temporizador-minutos" th:attr="data-id=${temporizador.id}">0</div>
                    <div class="temporizador-segundos" th:attr="data-id=${temporizador.id}">0</div>
                </div>
                    <td>
                        <a class="excluir" th:href="@{'/temporizadores/excluir/' + ${temporizador.id}}">Excluir</a>
                        
                    </td>

            </div>
        </div>

           <!-- Adicione um ID ao botão para facilitar a manipulação via JavaScript -->
           <form id="novoTemporizadorForm" action="/temporizadores/novo" method="get">
            <input type="submit" value="Novo Temporizador">
        </form>
        <div class="aviso" id="limiteMensagem" style="display: none; color: red;">
            Limite de 4 contadores atingido.
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener("DOMContentLoaded", function () {
            var contadorLimite = 4;
            var temporizadores = /*[[${temporizadores.size()}]]*/ 0; // Use a variável que representa a lista de temporizadores

            // Ocultar o botão se o limite for atingido
            if (temporizadores >= contadorLimite) {
                document.getElementById("novoTemporizadorForm").style.display = "none";
                document.getElementById("limiteMensagem").style.display = "block";
            }
            
        });
        /*]]>*/
    </script>
</body>

</html>